{"sections":[],"schemaVersion":{"minor":3,"patch":0,"major":0},"metadata":{"roleHeading":"API Collection","role":"collectionGroup","images":[{"type":"icon","identifier":"logo.png"}],"title":"Server protocol"},"kind":"article","primaryContentSections":[{"kind":"content","content":[{"text":"Overview","type":"heading","anchor":"Overview","level":2},{"type":"paragraph","inlineContent":[{"text":"By default a Hummingbird application runs with a HTTP\/1.1 server. The Hummingbird comes with additional libraries that allow you to change this to use TLS, HTTP2 and WebSockets","type":"text"}]},{"text":"Setting server protocol","level":3,"type":"heading","anchor":"Setting-server-protocol"},{"type":"paragraph","inlineContent":[{"text":"When you create your ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Application","isActive":true,"type":"reference"},{"type":"text","text":" there is a parameter "},{"code":"server","type":"codeVoice"},{"text":" that is used to define the server protocol and its configuration. Below we are creating a server that support HTTP1 with a idle timeout for requests set to one minutes.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let app = Application(","    router: router,","    server: .http1(idleTimeout: .seconds(60))",")"]},{"anchor":"HTTPSTLS","text":"HTTPS\/TLS","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"HTTPS is pretty much a requirement for a server these days. Many people run Nginx in front of their server to implement HTTPS, but it is also possible to setup HTTPS inside your Hummingbird application."}],"type":"paragraph"},{"code":["import HummingbirdTLS","","let tlsConfiguration = TLSConfiguration.makeServerConfiguration(","    certificateChain: certificateChain,","    privateKey: privateKey",")","let app = Application(","    router: router,","    server: .tls(.http1(), tlsConfiguration: tlsConfiguration)",")"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"HTTPS is the HTTP protocol with an added encryption layer of TLS to protect the traffic. The ","type":"text"},{"type":"codeVoice","code":"tls"},{"text":" function applies the encryption layer using the crytographic keys supplied in the ","type":"text"},{"code":"TLSConfiguration","type":"codeVoice"},{"type":"text","text":"."}]},{"type":"heading","anchor":"HTTP2","text":"HTTP2","level":2},{"type":"paragraph","inlineContent":[{"text":"HTTP2 is becoming increasingly common. It allows you to service multiple HTTP requests concurrently over one connection. The HTTP2 protocol does not require you to use TLS but it is in effect only supported over TLS as there arenâ€™t any web browsers that support HTTP2 without TLS. Given this the Hummingbird implementation also requires TLS.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["import HummingbirdHTTP2","","let app = Application(","    router: router,","    server: .http2(","        tlsConfiguration: tlsConfiguration,","        configuration: .init(","            idleTimeout: .seconds(60),","            gracefulCloseTimeout: .seconds(15),","            maxAgeTimeout: .seconds(900),","            streamConfiguration: .init(idleTimeout: .seconds(60))","        )","    )",")"]},{"type":"paragraph","inlineContent":[{"text":"The HTTP2 upgrade protocol has a fair amount of configuration. It includes a number of different timeouts,","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"idleTimeout"},{"text":": How long a connection is kept open while idle","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"gracefulCloseTimeout","type":"codeVoice"},{"text":": The maximum amount of time to wait for the client to respond before all streams are closed after the second GOAWAY is sent","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"maxAgeTimeout","type":"codeVoice"},{"text":": a maximum amount of time a connection should be open.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Then each HTTP2 stream (request) has its own idle timeout as well."}],"type":"paragraph"}]}]},{"text":"WebSockets","level":2,"type":"heading","anchor":"WebSockets"},{"type":"paragraph","inlineContent":[{"type":"text","text":"WebSocket upgrades are also implemented via the server protocol parameter."}]},{"syntax":"swift","code":["import HummingbirdWebSocket","","let app = Application(","    router: router,","    server: .http1WebSocketUpgrade { request, channel, logger in","        \/\/ upgrade if request URI is \"\/ws\"","        guard request.uri == \"\/ws\" else { return .dontUpgrade }","        \/\/ The upgrade response includes the headers to include in the response and ","        \/\/ the WebSocket handler","        return .upgrade([:]) { inbound, outbound, context in","            for try await frame in inbound {","                \/\/ send \"Received\" for every frame we receive","                try await outbound.write(.text(\"Received\"))","            }","        }","    }",")"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"In a similar way you add TLS encryption to the HTTP1 connection you can also add TLS to a connection that accepts WebSocket upgrades."}],"type":"paragraph"},{"syntax":"swift","code":["let app = Application(","    router: router,","    server: .tls(","        .http1WebSocketUpgrade { request, channel, logger in","            \/\/ upgrade if request URI is \"\/ws\"","            guard request.uri == \"\/ws\" else { return .dontUpgrade }","            \/\/ The upgrade response includes the headers to include in the response and ","            \/\/ the WebSocket handler","            return .upgrade([:]) { inbound, outbound, context in","                try await outbound.write(.text(\"Hello\"))","            }","        },","        tlsConfiguration: tlsConfiguration","    )    ",")"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"To find out more about WebSocket upgrades and handling WebSocket connections read "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade","isActive":true},{"text":".","type":"text"}],"type":"paragraph"}]}],"seeAlsoSections":[{"title":"Hummingbird Server","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestDecoding","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ResponseEncoding","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MiddlewareGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LoggingMetricsAndTracing","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterBuilderGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServiceLifecycle","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Testing","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2"],"generated":true,"anchor":"Hummingbird-Server"}],"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServerProtocol"},"abstract":[{"text":"Support for TLS and HTTP2 upgrades","type":"text"}],"topicSections":[{"anchor":"Reference","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdHTTP2","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdTLS","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdWebSocket"],"title":"Reference"}],"references":{"doc://com.opticalaberration.hummingbird/documentation/HummingbirdWebSocket":{"kind":"symbol","url":"\/documentation\/hummingbirdwebsocket","title":"HummingbirdWebSocket","images":[{"identifier":"logo.png","type":"icon"}],"role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdWebSocket","type":"topic","abstract":[{"type":"text","text":"Adds support for upgrading HTTP connections to WebSocket."}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ResponseEncoding":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ResponseEncoding","abstract":[{"type":"text","text":"Writing Responses using JSON and other formats."}],"title":"Response Encoding","images":[{"identifier":"logo.png","type":"icon"}],"kind":"article","url":"\/documentation\/hummingbird\/responseencoding","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RequestDecoding":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestDecoding","abstract":[{"text":"Decoding of Requests with JSON content and other formats.","type":"text"}],"title":"Request Decoding","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/requestdecoding","type":"topic","role":"article"},"logo.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/com.opticalaberration.hummingbird\/logo.png"}],"type":"image","alt":null,"identifier":"logo.png"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/WebSocketServerUpgrade":{"type":"topic","title":"WebSocket Server Upgrade","kind":"article","role":"article","abstract":[{"type":"text","text":"Support for upgrading HTTP1 connections to WebSocket."}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/websocketserverupgrade","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/Testing":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Testing","abstract":[{"type":"text","text":"Using the HummingbirdTesting framework to test your application"}],"title":"Testing","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/testing","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ServiceLifecycle":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServiceLifecycle","abstract":[{"text":"Integration with Swift Service Lifecycle","type":"text"}],"title":"Service Lifecycle","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/servicelifecycle","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdHTTP2":{"title":"HummingbirdHTTP2","kind":"symbol","abstract":[{"type":"text","text":"Add HTTP2 support to Hummingbird server."}],"role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdHTTP2","images":[{"type":"icon","identifier":"logo.png"}],"url":"\/documentation\/hummingbirdhttp2","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdTLS":{"kind":"symbol","url":"\/documentation\/hummingbirdtls","title":"HummingbirdTLS","images":[{"identifier":"logo.png","type":"icon"}],"role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdTLS","type":"topic","abstract":[{"type":"text","text":"Add TLS support to Hummingbird server."}]},"doc://com.opticalaberration.hummingbird/documentation/index":{"kind":"article","url":"\/documentation\/index","title":"Hummingbird Documentation","images":[{"type":"icon","identifier":"logo.png"}],"role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index","type":"topic","abstract":[{"type":"text","text":"Documentation for Hummingbird the lightweight, flexible, modern server framework."}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RouterBuilderGuide":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterBuilderGuide","abstract":[{"type":"text","text":"Building your router using a result builder."}],"title":"Result Builder Router","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/routerbuilderguide","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ErrorHandling":{"type":"topic","title":"Error Handling","kind":"article","role":"article","abstract":[{"type":"text","text":"How to build errors for the server to return."}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/errorhandling","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RequestContexts":{"type":"topic","title":"Request Contexts","kind":"article","role":"article","abstract":[{"type":"text","text":"Controlling contextual data provided to middleware and route handlers"}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/requestcontexts","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RouterGuide":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterGuide","abstract":[{"text":"The router directs requests to their handlers based on the contents of their path.","type":"text"}],"title":"Router","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/routerguide","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MigratingToV2":{"type":"topic","title":"Migrating to Hummingbird v2","kind":"article","role":"article","abstract":[{"type":"text","text":"Migration guide for converting Hummingbird v1 applications to Hummingbird v2"}],"images":[{"type":"icon","identifier":"logo.png"}],"url":"\/documentation\/hummingbird\/migratingtov2","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/Application":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Application","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"Application"}],"navigatorTitle":[{"kind":"identifier","text":"Application"}],"title":"Application","url":"\/documentation\/hummingbird\/application","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"Application type bringing together all the components of Hummingbird"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/PersistentData":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData","abstract":[{"text":"How to persist data between requests to your server.","type":"text"}],"title":"Persistent data","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","url":"\/documentation\/hummingbird\/persistentdata","type":"topic","role":"article"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MiddlewareGuide":{"type":"topic","title":"Middleware","kind":"article","role":"article","abstract":[{"type":"text","text":"Processing requests and responses outside of request handlers."}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/middlewareguide","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MiddlewareGuide"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/LoggingMetricsAndTracing":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LoggingMetricsAndTracing","abstract":[{"text":"Considered the three pillars of observability, logging, metrics and tracing provide different ways of viewing how your application is working.","type":"text"}],"title":"Logging, Metrics and Tracing","images":[{"identifier":"logo.png","type":"icon"}],"kind":"article","url":"\/documentation\/hummingbird\/loggingmetricsandtracing","type":"topic","role":"article"}}}