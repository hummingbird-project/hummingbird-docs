{"metadata":{"role":"article","title":"Logging, Metrics and Tracing","images":[{"type":"icon","identifier":"logo.png"}],"roleHeading":"Article"},"seeAlsoSections":[{"title":"Related Documentation","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LogRequestsMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MetricsMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/TracingMiddleware"],"anchor":"Related-Documentation"},{"title":"Hummingbird Server","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestDecoding","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ResponseEncoding","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MiddlewareGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterBuilderGuide","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServerProtocol","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServiceLifecycle","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Testing","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2"],"generated":true,"anchor":"Hummingbird-Server"}],"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LoggingMetricsAndTracing","interfaceLanguage":"swift"},"schemaVersion":{"minor":3,"patch":0,"major":0},"primaryContentSections":[{"content":[{"type":"heading","text":"Overview","anchor":"Overview","level":2},{"type":"paragraph","inlineContent":[{"text":"Apple has developed packages for each of the observability systems (","type":"text"},{"identifier":"https:\/\/github.com\/apple\/swift-log","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"https:\/\/github.com\/apple\/swift-metrics","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"https:\/\/github.com\/apple\/swift-distributed-tracing","isActive":true,"type":"reference"},{"text":"). They provide a consistent API while not defining how the backend is implemented. With these it is possible to add observability to your own libraries without commiting to a certain implementation of each system.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Hummingbird has middleware for each of these systems. As these are provided as middleware you can add these to your application as and when you need them.","type":"text"}]},{"type":"heading","text":"Logging","anchor":"Logging","level":2},{"type":"paragraph","inlineContent":[{"text":"Logs provides a record of discrete events over time. Each event has a timestamp, description and an array of metadata. Hummingbird automatically does some logging of events. You can control the fidelity of your logging by providing your own ","type":"text"},{"code":"Logger","type":"codeVoice"},{"text":" when creating your ","type":"text"},{"code":"Application","type":"codeVoice"},{"text":" eg","type":"text"}]},{"type":"codeListing","code":["var logger = Logger(label: \"MyLogger\")","logger.logLevel = .debug","let application = Application(","    router: router,","    logger: logger",")"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"If you want a record of every request to the server you can add the ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LogRequestsMiddleware"},{"text":" middleware. You can control at what ","type":"text"},{"code":"logLevel","type":"codeVoice"},{"text":" the request logging will occur and whether it includes information about each requests headers. eg","type":"text"}]},{"type":"codeListing","code":["let router = Router()","router.middlewares.add(LogRequestsMiddleware(.debug, includeHeaders: false))"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you would like to add your own logging, or implement your own logging backend you can find out more "},{"identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-log\/main\/documentation\/logging","isActive":true,"type":"reference"},{"type":"text","text":". A complete list of logging implementations can be found "},{"identifier":"https:\/\/github.com\/apple\/swift-log#selecting-a-logging-backend-implementation-applications-only","isActive":true,"type":"reference"},{"type":"text","text":"."}]},{"type":"heading","text":"Metrics","anchor":"Metrics","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Metrics provides an overview of how your application is working over time. It allows you to create visualisations of the state of your application."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The middleware "},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MetricsMiddleware","type":"reference","isActive":true},{"type":"text","text":" will record how many requests are being made to each route, how long they took and how many failed. To add recording of these metrics to your Hummingbird application you need to add this middleware and bootstrap your chosen metrics backend. Below is an example setting up recording metrics with Prometheus, using the package "},{"identifier":"https:\/\/github.com\/swift-server-community\/SwiftPrometheus","type":"reference","isActive":true},{"type":"text","text":"."}]},{"type":"codeListing","code":["import Metrics","import Prometheus","","\/\/ Bootstrap Prometheus","let prometheus = PrometheusClient()","MetricsSystem.bootstrap(PrometheusMetricsFactory(client: prometheus))","","\/\/ Add metrics middleware to router","router.middlewares.add(MetricsMiddleware())"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you would like to record your own metrics, or implement your own metrics backed you can find out more "},{"identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-metrics\/main\/documentation\/coremetrics","isActive":true,"type":"reference"},{"type":"text","text":". A list of metrics backend implementations can be found "},{"identifier":"https:\/\/github.com\/apple\/swift-metrics#selecting-a-metrics-backend-implementation-applications-only","isActive":true,"type":"reference"},{"type":"text","text":"."}]},{"type":"heading","text":"Tracing","anchor":"Tracing","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Tracing is used to understand how data flows through an applicationâ€™s various services."}]},{"type":"paragraph","inlineContent":[{"text":"The middleware ","type":"text"},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/TracingMiddleware","isActive":true},{"text":" will record spans for each request made to your application and attach the relevant metadata about request and responses. To add tracing to your Hummingbird application you need to add this middleware and bootstrap your chosen tracing backend. Below is an example setting up tracing using the Open Telemetry package ","type":"text"},{"type":"reference","identifier":"https:\/\/github.com\/slashmo\/swift-otel","isActive":true},{"text":".","type":"text"}]},{"type":"codeListing","code":["import OpenTelemetry","import Tracing","","\/\/ Bootstrap Open Telemetry and create OTel service","var otelConfig = OTel.Configuration.default","otelConfig.serviceName = \"Hummingbird\"","let otel = try OTel.bootstrap(configuration: otelConfig)","","\/\/ Add tracing middleware","router.middlewares.add(TracingMiddleware(recordingHeaders: [\"content-type\", \"content-length\"]))","","\/\/ Include otel in Hummingbird services","let application = Application(","    router: router,","    services: [otel]",")"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you would like to find out more about tracing, or implement your own tracing backend you can find out more "},{"type":"reference","identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-distributed-tracing\/main\/documentation\/tracing","isActive":true},{"type":"text","text":"."}]}],"kind":"content"}],"sections":[],"kind":"article","abstract":[{"text":"Considered the three pillars of observability, logging, metrics and tracing provide different ways of viewing how your application is working.","type":"text"}],"references":{"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/TracingMiddleware":{"abstract":[{"type":"text","text":"Middleware creating Distributed Tracing spans for each request."}],"navigatorTitle":[{"text":"TracingMiddleware","kind":"identifier"}],"type":"topic","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"TracingMiddleware","kind":"identifier"}],"kind":"symbol","role":"symbol","url":"\/documentation\/hummingbird\/tracingmiddleware","title":"TracingMiddleware","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/TracingMiddleware"},"https://github.com/apple/swift-log#selecting-a-logging-backend-implementation-applications-only":{"titleInlineContent":[{"text":"here","type":"text"}],"title":"here","type":"link","url":"https:\/\/github.com\/apple\/swift-log#selecting-a-logging-backend-implementation-applications-only","identifier":"https:\/\/github.com\/apple\/swift-log#selecting-a-logging-backend-implementation-applications-only"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RequestDecoding":{"type":"topic","abstract":[{"text":"Decoding of Requests with JSON content and other formats.","type":"text"}],"images":[{"type":"icon","identifier":"logo.png"}],"url":"\/documentation\/hummingbird\/requestdecoding","kind":"article","title":"Request Decoding","role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestDecoding"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/Testing":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Testing","url":"\/documentation\/hummingbird\/testing","type":"topic","role":"article","abstract":[{"type":"text","text":"Using the HummingbirdTesting framework to test your application"}],"kind":"article","images":[{"type":"icon","identifier":"logo.png"}],"title":"Testing"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ServerProtocol":{"type":"topic","abstract":[{"text":"Support for TLS and HTTP2 upgrades","type":"text"}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/serverprotocol","kind":"article","title":"Server protocol","role":"collectionGroup","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServerProtocol"},"https://github.com/swift-server-community/SwiftPrometheus":{"url":"https:\/\/github.com\/swift-server-community\/SwiftPrometheus","identifier":"https:\/\/github.com\/swift-server-community\/SwiftPrometheus","title":"SwiftPrometheus","type":"link","titleInlineContent":[{"text":"SwiftPrometheus","type":"text"}]},"https://github.com/slashmo/swift-otel":{"url":"https:\/\/github.com\/slashmo\/swift-otel","identifier":"https:\/\/github.com\/slashmo\/swift-otel","title":"swift-otel","titleInlineContent":[{"text":"swift-otel","type":"text"}],"type":"link"},"doc://com.opticalaberration.hummingbird/documentation/index":{"type":"topic","abstract":[{"type":"text","text":"Documentation for Hummingbird the lightweight, flexible, modern server framework."}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/index","kind":"article","title":"Hummingbird Documentation","role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"},"https://github.com/apple/swift-metrics":{"titleInlineContent":[{"text":"swift-metrics","type":"text"}],"title":"swift-metrics","type":"link","url":"https:\/\/github.com\/apple\/swift-metrics","identifier":"https:\/\/github.com\/apple\/swift-metrics"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RouterBuilderGuide":{"type":"topic","abstract":[{"text":"Building your router using a result builder.","type":"text"}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/routerbuilderguide","kind":"article","title":"Result Builder Router","role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterBuilderGuide"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/PersistentData":{"type":"topic","abstract":[{"text":"How to persist data between requests to your server.","type":"text"}],"images":[{"type":"icon","identifier":"logo.png"}],"url":"\/documentation\/hummingbird\/persistentdata","kind":"article","title":"Persistent data","role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData"},"https://github.com/apple/swift-distributed-tracing":{"url":"https:\/\/github.com\/apple\/swift-distributed-tracing","identifier":"https:\/\/github.com\/apple\/swift-distributed-tracing","title":"swift-distributed-tracing","type":"link","titleInlineContent":[{"text":"swift-distributed-tracing","type":"text"}]},"https://github.com/apple/swift-log":{"url":"https:\/\/github.com\/apple\/swift-log","identifier":"https:\/\/github.com\/apple\/swift-log","title":"swift-log","titleInlineContent":[{"text":"swift-log","type":"text"}],"type":"link"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RequestContexts":{"type":"topic","abstract":[{"text":"Controlling contextual data provided to middleware and route handlers","type":"text"}],"images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/requestcontexts","kind":"article","title":"Request Contexts","role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts"},"https://github.com/apple/swift-metrics#selecting-a-metrics-backend-implementation-applications-only":{"titleInlineContent":[{"text":"here","type":"text"}],"title":"here","type":"link","url":"https:\/\/github.com\/apple\/swift-metrics#selecting-a-metrics-backend-implementation-applications-only","identifier":"https:\/\/github.com\/apple\/swift-metrics#selecting-a-metrics-backend-implementation-applications-only"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ResponseEncoding":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ResponseEncoding","url":"\/documentation\/hummingbird\/responseencoding","type":"topic","role":"article","abstract":[{"text":"Writing Responses using JSON and other formats.","type":"text"}],"kind":"article","images":[{"type":"icon","identifier":"logo.png"}],"title":"Response Encoding"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MiddlewareGuide":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MiddlewareGuide","role":"article","kind":"article","images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/hummingbird\/middlewareguide","title":"Middleware","abstract":[{"type":"text","text":"Processing requests and responses outside of request handlers."}],"type":"topic"},"https://swiftpackageindex.com/apple/swift-metrics/main/documentation/coremetrics":{"url":"https:\/\/swiftpackageindex.com\/apple\/swift-metrics\/main\/documentation\/coremetrics","identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-metrics\/main\/documentation\/coremetrics","title":"here","type":"link","titleInlineContent":[{"text":"here","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ErrorHandling":{"abstract":[{"type":"text","text":"How to build errors for the server to return."}],"type":"topic","images":[{"type":"icon","identifier":"logo.png"}],"kind":"article","role":"article","url":"\/documentation\/hummingbird\/errorhandling","title":"Error Handling","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RouterGuide":{"type":"topic","abstract":[{"text":"The router directs requests to their handlers based on the contents of their path.","type":"text"}],"images":[{"type":"icon","identifier":"logo.png"}],"url":"\/documentation\/hummingbird\/routerguide","kind":"article","title":"Router","role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RouterGuide"},"https://swiftpackageindex.com/apple/swift-distributed-tracing/main/documentation/tracing":{"url":"https:\/\/swiftpackageindex.com\/apple\/swift-distributed-tracing\/main\/documentation\/tracing","identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-distributed-tracing\/main\/documentation\/tracing","title":"here","titleInlineContent":[{"text":"here","type":"text"}],"type":"link"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MigratingToV2":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2","url":"\/documentation\/hummingbird\/migratingtov2","type":"topic","role":"article","abstract":[{"type":"text","text":"Migration guide for converting Hummingbird v1 applications to Hummingbird v2"}],"kind":"article","images":[{"type":"icon","identifier":"logo.png"}],"title":"Migrating to Hummingbird v2"},"https://swiftpackageindex.com/apple/swift-log/main/documentation/logging":{"titleInlineContent":[{"text":"here","type":"text"}],"title":"here","type":"link","url":"https:\/\/swiftpackageindex.com\/apple\/swift-log\/main\/documentation\/logging","identifier":"https:\/\/swiftpackageindex.com\/apple\/swift-log\/main\/documentation\/logging"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ServiceLifecycle":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ServiceLifecycle","url":"\/documentation\/hummingbird\/servicelifecycle","type":"topic","role":"article","abstract":[{"text":"Integration with Swift Service Lifecycle","type":"text"}],"kind":"article","images":[{"identifier":"logo.png","type":"icon"}],"title":"Service Lifecycle"},"logo.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/com.opticalaberration.hummingbird\/logo.png"}],"identifier":"logo.png","alt":null,"type":"image"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/LogRequestsMiddleware":{"url":"\/documentation\/hummingbird\/logrequestsmiddleware","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"LogRequestsMiddleware","kind":"identifier"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LogRequestsMiddleware","kind":"symbol","abstract":[{"type":"text","text":"Middleware outputting to log for every call to server."}],"type":"topic","role":"symbol","title":"LogRequestsMiddleware","navigatorTitle":[{"text":"LogRequestsMiddleware","kind":"identifier"}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MetricsMiddleware":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MetricsMiddleware","url":"\/documentation\/hummingbird\/metricsmiddleware","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"MetricsMiddleware","kind":"identifier"}],"type":"topic","navigatorTitle":[{"text":"MetricsMiddleware","kind":"identifier"}],"role":"symbol","abstract":[{"type":"text","text":"Middleware recording metrics for each request"}],"kind":"symbol","title":"MetricsMiddleware"}}}