{"identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketClientGuide","interfaceLanguage":"swift"},"metadata":{"roleHeading":"Article","title":"WebSocket Client","role":"article","images":[{"identifier":"logo.png","type":"icon"}]},"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"kind":"article","abstract":[{"type":"text","text":"Connecting to WebSocket servers."}],"schemaVersion":{"patch":0,"major":0,"minor":3},"primaryContentSections":[{"content":[{"text":"Overview","level":2,"type":"heading","anchor":"overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"A WebSocket connection is only setup after an initial HTTP upgrade request has been sent. "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSClient\/WebSocketClient"},{"text":" manages the process of sending the initial HTTP request and then the handling of the WebSocket once it has been upgraded.","type":"text"}]},{"text":"Setup","level":2,"type":"heading","anchor":"Setup"},{"type":"paragraph","inlineContent":[{"text":"A WebSocket client is created with the server URL, a closure to handle the connection and optional configuration values. To connect call ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSClient\/WebSocketClient\/run()","type":"reference","isActive":true},{"text":". This will exit once the WebSocket connection has closed.","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let ws = WebSocketClient(url: \"ws:\/\/mywebsocket\/ws\") { inbound, outbound, context in","    try await outbound.write(.text(\"Hello\"))","    for try await frame in inbound {","        context.logger.info(frame)","    }","}","try await ws.run()"]},{"type":"paragraph","inlineContent":[{"text":"As a shortcut you can call the following which will initialize and run the WebSocket client in one function call","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["try await WebSocketClient.connect(url: \"ws:\/\/mywebsocket\/ws\") { inbound, outbound, context in","    try await outbound.write(.text(\"Hello\"))","    for try await frame in inbound {","        context.logger.info(frame)","    }","}"]},{"type":"paragraph","inlineContent":[{"code":"WebSocketClient","type":"codeVoice"},{"text":" supports unencrypted and TLS connections. These are indicated via the URL scheme: ","type":"text"},{"code":"ws","type":"codeVoice"},{"type":"text","text":" and "},{"type":"codeVoice","code":"wss"},{"type":"text","text":" respectively. If you provide an "},{"type":"codeVoice","code":"NIOTSEventLoopGroup"},{"type":"text","text":" for the "},{"type":"codeVoice","code":"EventLoopGroup"},{"type":"text","text":" at initialization then client will use the Network.framework to setup the WebSocket connection."}]},{"type":"heading","text":"Handler","anchor":"Handler","level":2},{"type":"paragraph","inlineContent":[{"text":"The handler closure works exactly like the WebSocket server handler. You are provided with a inbound sequence of frames and an outbound WebSocket frame writer. The connection will close as sooon as you exit the function. PING, PONG and CLOSE frames are all dealt with internally. If you want to send a regular PING keep-alive you can control that via the WebSocket configuration. By default clients do not send a regular PING.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"More details on the WebSocket handler can be found in the ","type":"text"},{"isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade#WebSocket-Handler","type":"reference"},{"type":"text","text":" section of the WebSocket server upgrade guide."}]}],"kind":"content"}],"seeAlsoSections":[{"anchor":"Related-Documentation","title":"Related Documentation","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSCore\/WebSocketInboundStream","doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSCore\/WebSocketOutboundWriter"]},{"anchor":"WebSockets","title":"WebSockets","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade"],"generated":true}],"sections":[],"references":{"doc://com.opticalaberration.hummingbird/documentation/WSClient/WebSocketClient/run()":{"url":"\/documentation\/wsclient\/websocketclient\/run()","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"run","kind":"identifier"},{"text":"() ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"preciseIdentifier":"s:6WSCore19WebSocketCloseFrameV","kind":"typeIdentifier","text":"WebSocketCloseFrame"},{"kind":"text","text":"?"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSClient\/WebSocketClient\/run()","title":"run()","abstract":[{"text":"Connect and run handler","type":"text"}],"kind":"symbol","role":"symbol","type":"topic"},"logo.png":{"variants":[{"url":"\/images\/com.opticalaberration.hummingbird\/logo.png","traits":["1x","light"]}],"type":"image","identifier":"logo.png","alt":null},"doc://com.opticalaberration.hummingbird/documentation/WSCore/WebSocketInboundStream":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSCore\/WebSocketInboundStream","title":"WebSocketInboundStream","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"WebSocketInboundStream","kind":"identifier"}],"role":"symbol","navigatorTitle":[{"text":"WebSocketInboundStream","kind":"identifier"}],"url":"\/documentation\/wscore\/websocketinboundstream","type":"topic","abstract":[{"text":"Inbound WebSocket data frame AsyncSequence","type":"text"}],"kind":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/WSCore/WebSocketOutboundWriter":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSCore\/WebSocketOutboundWriter","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"WebSocketOutboundWriter"}],"title":"WebSocketOutboundWriter","abstract":[{"type":"text","text":"Outbound websocket writer"}],"kind":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"WebSocketOutboundWriter"}],"type":"topic","url":"\/documentation\/wscore\/websocketoutboundwriter"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/WebSocketServerUpgrade":{"url":"\/documentation\/hummingbird\/websocketserverupgrade","images":[{"type":"icon","identifier":"logo.png"}],"abstract":[{"text":"Support for upgrading HTTP1 connections to WebSocket.","type":"text"}],"kind":"article","title":"WebSocket Server Upgrade","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade","role":"article","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/index":{"url":"\/documentation\/index","images":[{"identifier":"logo.png","type":"icon"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index","abstract":[{"text":"Documentation for Hummingbird the lightweight, flexible, modern server framework.","type":"text"}],"title":"Hummingbird Documentation","kind":"article","role":"collection","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/WebSocketServerUpgrade#WebSocket-Handler":{"kind":"section","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/WebSocketServerUpgrade#WebSocket-Handler","abstract":[],"type":"topic","title":"WebSocket Handler","url":"\/documentation\/hummingbird\/websocketserverupgrade#WebSocket-Handler"},"doc://com.opticalaberration.hummingbird/documentation/WSClient/WebSocketClient":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/WSClient\/WebSocketClient","title":"WebSocketClient","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"WebSocketClient","kind":"identifier"}],"role":"symbol","navigatorTitle":[{"text":"WebSocketClient","kind":"identifier"}],"kind":"symbol","type":"topic","abstract":[{"type":"text","text":"WebSocket client"}],"url":"\/documentation\/wsclient\/websocketclient"}}}