{"identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/JobsGuide","interfaceLanguage":"swift"},"seeAlsoSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobParameters","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobQueue","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobSchedule"],"title":"Related Documentation","anchor":"Related-Documentation"}],"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","type":"heading","text":"Overview","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"A Job consists of a payload and an execute method to run the job. Swift Jobs provides a framework for pushing jobs onto a queue and processing them at a later point. If the driver backing up the job queue uses persistent storage then a separate server can be used to process the jobs. The module comes with a driver that stores jobs in local memory and uses your current server to process the jobs, but there are also implementations in "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsRedis"},{"type":"text","text":" and "},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsPostgres","type":"reference","isActive":true},{"type":"text","text":" that implement the job queue using a Redis database or Postgres database."}]},{"level":3,"anchor":"Setting-up-a-Job-queue","type":"heading","text":"Setting up a Job queue"},{"inlineContent":[{"type":"text","text":"Before you can start adding or processing jobs you need to setup a Jobs queue to push jobs onto. Below we create a job queue stored in local memory that will process four jobs concurrently."}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let jobQueue = JobQueue(.memory, numWorkers: 4, logger: logger)"]},{"level":3,"text":"Creating a Job","anchor":"Creating-a-Job","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before you can start running jobs you need to define a job. A job definition requires an identifier for the job, the job parameters and the function that runs the job."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"We use a struct conforming to "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobParameters","isActive":true},{"text":" to define the job parameters and identifier.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["struct SendEmailJobParameters: JobParameters {","    \/\/\/ jobName is used to create the job identifier. It should be unique","    static let jobName = \"SendEmail\"","    let to: String","    let subject: String","    let body: String","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then we register the job with a job queue and also provide a closure that executes the job."}]},{"code":["jobQueue.registerJob(parameters: SendEmailJobParameters.self) { parameters, context in","    try await myEmailService.sendEmail(to: parameters.to, subject: parameters.subject, body: parameters.body)","}"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"Now your job is ready to create. Jobs can be queued up using the function "},{"code":"push","type":"codeVoice"},{"type":"text","text":" on "},{"type":"codeVoice","code":"JobQueue"},{"type":"text","text":"."}],"type":"paragraph"},{"syntax":"swift","code":["let job = SendEmailJobParameters(","    to: \"joe@email.com\",","    subject: \"Testing Jobs\",","    message: \"...\"",")","jobQueue.push(job)"],"type":"codeListing"},{"level":3,"text":"Processing Jobs","type":"heading","anchor":"Processing-Jobs"},{"inlineContent":[{"text":"When you create a ","type":"text"},{"code":"JobQueue","type":"codeVoice"},{"type":"text","text":" the "},{"code":"numWorkers","type":"codeVoice"},{"type":"text","text":" parameter indicates how many jobs you want serviced concurrently by the job queue. If you want to activate these workers you need to add the job queue to your "},{"type":"codeVoice","code":"ServiceGroup"},{"text":".","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["let serviceGroup = ServiceGroup(","    services: [server, jobQueue],","    configuration: .init(gracefulShutdownSignals: [.sigterm, .sigint]),","    logger: logger",")","try await serviceGroup.run()"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Or it can be added to the array of services that "},{"code":"Application","type":"codeVoice"},{"type":"text","text":" manages"}]},{"type":"codeListing","syntax":"swift","code":["let app = Application(...)","app.addServices(jobQueue)"]},{"type":"paragraph","inlineContent":[{"text":"If you want to process jobs on a separate server you will need to use a job queue driver that saves to some external storage eg ","type":"text"},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsRedis\/RedisJobQueue","isActive":true},{"type":"text","text":" or "},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsPostgres\/PostgresJobQueue","isActive":true,"type":"reference"},{"type":"text","text":"."}]},{"text":"Job Scheduler","level":2,"type":"heading","anchor":"Job-Scheduler"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Jobs framework comes with a scheduler "},{"code":"Service","type":"codeVoice"},{"text":" that allows you to schedule jobs to occur at regular times. Job schedules are defined using the ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobSchedule","isActive":true,"type":"reference"},{"type":"text","text":" type."}]},{"syntax":"swift","code":["var jobSchedule = JobSchedule()","jobSchedule.addJob(BirthdayRemindersJob(), schedule: .daily(hour: 9))","jobSchedule.addJob(CleanupStaleSessionDataJob(), schedule: .weekly(day: .sunday, hour: 4))"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"To get your ","type":"text"},{"type":"codeVoice","code":"JobSchedule"},{"text":" to schedule jobs on a ","type":"text"},{"type":"codeVoice","code":"JobQueue"},{"type":"text","text":" you need to create the scheduler "},{"type":"codeVoice","code":"Service"},{"text":" and then add it to your ","type":"text"},{"type":"codeVoice","code":"Application"},{"type":"text","text":" service list or "},{"code":"ServiceGroup","type":"codeVoice"},{"type":"text","text":"."}]},{"code":["var app = Application(router: router)","app.addService(jobSchedule.scheduler(on: jobQueue, named: \"MyScheduler\"))"],"type":"codeListing","syntax":"swift"},{"anchor":"Schedule-types","type":"heading","level":3,"text":"Schedule types"},{"inlineContent":[{"text":"A ","type":"text"},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/Schedule","isActive":true},{"text":" can be setup in a number of ways. It includes functions to trigger once every minute, hour, day, month, week day and functions to trigger on multiple minutes, hours, etc.","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["jobSchedule.addJob(TestJobParameters(), schedule: .hourly(minute: 30))","jobSchedule.addJob(TestJobParameters(), schedule: .yearly(month: 4, date: 1, hour: 8))","jobSchedule.addJob(TestJobParameters(), schedule: .onMinutes([0,15,30,45]))","jobSchedule.addJob(TestJobParameters(), schedule: .onDays([.saturday, .sunday], hour: 12, minute: 45))"]},{"type":"paragraph","inlineContent":[{"text":"If these aren’t flexible enough a ","type":"text"},{"code":"Schedule","type":"codeVoice"},{"text":" can be setup using a five value crontab format. Most crontabs are supported but combinations setting both week day and date are not supported.","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["jobSchedule.addJob(TestJobParameters(), schedule: .crontab(\"0 12 * * *\")) \/\/ daily at 12 o'clock","jobSchedule.addJob(TestJobParameters(), schedule: .crontab(\"0 *\/4 * * sat,sun\")) \/\/ every four hours on Saturday and Sunday","jobSchedule.addJob(TestJobParameters(), schedule: .crontab(\"@daily\")) \/\/ crontab default, every day at midnight "]},{"type":"heading","level":3,"text":"Schedule accuracy","anchor":"Schedule-accuracy"},{"inlineContent":[{"type":"text","text":"You can setup how accurate you want your scheduler to adhere to the schedule regardless of whether the scheduler is running or not. Obviously if your scheduler is not running it cannot schedule jobs. But you can use the "},{"type":"codeVoice","code":"accuracy"},{"type":"text","text":" parameter of a schedule to indicate what you want your scheduler to do once it comes back online after having been down."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Setting it to "},{"code":".all","type":"codeVoice"},{"type":"text","text":" will schedule a job for every trigger point it missed eg if your scheduler was down for 6 hours and you had a hourly schedule it would push a job to the JobQueue for every one of those hours missed. Setting it to "},{"type":"codeVoice","code":".latest"},{"type":"text","text":" will mean it only schedules a job for last trigger point if it was missed. If you don’t set the value then it will default to "},{"type":"codeVoice","code":".latest"},{"text":".","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["jobSchedule.addJob(TestJobParameters(), schedule: .hourly(minute: 30), accuracy: .all)"],"type":"codeListing"}]}],"metadata":{"role":"article","images":[{"type":"icon","identifier":"logo.png"}],"title":"Jobs","roleHeading":"Article"},"kind":"article","hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"abstract":[{"type":"text","text":"Offload work your server would be doing to another server."}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"references":{"doc://com.opticalaberration.hummingbird/documentation/JobsPostgres":{"type":"topic","images":[{"identifier":"logo.png","type":"icon"}],"kind":"symbol","role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsPostgres","url":"\/documentation\/jobspostgres","title":"JobsPostgres","abstract":[{"text":"Postgres implementation for Hummingbird jobs framework","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/Jobs/JobSchedule":{"navigatorTitle":[{"text":"JobSchedule","kind":"identifier"}],"kind":"symbol","url":"\/documentation\/jobs\/jobschedule","title":"JobSchedule","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"JobSchedule","kind":"identifier"}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobSchedule","type":"topic","abstract":[{"type":"text","text":"An array of Jobs with schedules detailing when they should be run"}]},"doc://com.opticalaberration.hummingbird/documentation/JobsRedis/RedisJobQueue":{"title":"RedisJobQueue","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsRedis\/RedisJobQueue","kind":"symbol","fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"RedisJobQueue","kind":"identifier"}],"url":"\/documentation\/jobsredis\/redisjobqueue","type":"topic","role":"symbol","navigatorTitle":[{"text":"RedisJobQueue","kind":"identifier"}],"abstract":[{"text":"Redis implementation of job queue driver","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/Jobs/JobParameters":{"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobParameters","kind":"symbol","abstract":[{"text":"Defines job parameters and identifier","type":"text"}],"navigatorTitle":[{"kind":"identifier","text":"JobParameters"}],"title":"JobParameters","type":"topic","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"JobParameters"}],"url":"\/documentation\/jobs\/jobparameters"},"logo.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/com.opticalaberration.hummingbird\/logo.png"}],"type":"image","alt":null,"identifier":"logo.png"},"doc://com.opticalaberration.hummingbird/documentation/Jobs/Schedule":{"type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Schedule"}],"kind":"symbol","navigatorTitle":[{"text":"Schedule","kind":"identifier"}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/Schedule","title":"Schedule","url":"\/documentation\/jobs\/schedule","abstract":[{"text":"Generates a Date at regular intervals (hourly, daily, weekly etc)","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/Jobs/JobQueue":{"navigatorTitle":[{"kind":"identifier","text":"JobQueue"}],"kind":"symbol","url":"\/documentation\/jobs\/jobqueue","title":"JobQueue","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"JobQueue","kind":"identifier"}],"role":"symbol","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Jobs\/JobQueue","abstract":[{"type":"text","text":"Job queue"}]},"doc://com.opticalaberration.hummingbird/documentation/index":{"kind":"article","url":"\/documentation\/index","title":"Hummingbird Documentation","images":[{"type":"icon","identifier":"logo.png"}],"role":"collection","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index","type":"topic","abstract":[{"type":"text","text":"Documentation for Hummingbird the lightweight, flexible, modern server framework."}]},"doc://com.opticalaberration.hummingbird/documentation/JobsRedis":{"title":"JobsRedis","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsRedis","kind":"symbol","url":"\/documentation\/jobsredis","images":[{"type":"icon","identifier":"logo.png"}],"type":"topic","role":"collection","abstract":[{"text":"Redis implementation for Hummingbird jobs framework","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/JobsPostgres/PostgresJobQueue":{"type":"topic","fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"PostgresJobQueue","kind":"identifier"}],"kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"PostgresJobQueue"}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/JobsPostgres\/PostgresJobQueue","url":"\/documentation\/jobspostgres\/postgresjobqueue","title":"PostgresJobQueue","abstract":[{"text":"Postgres Job queue implementation","type":"text"}]}}}